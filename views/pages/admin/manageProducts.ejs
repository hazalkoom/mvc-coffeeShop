<%- include('../../partials/Aheader') %>

<div class="page-header">
    <h1>Manage Products</h1>
    <a href="/admin/products/add" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add New Product
    </a>
</div>

<div class="card">
    <form action="/admin/products" method="GET" class="filter-form">
        <input type="text" name="search" placeholder="Search by name, brand..." value="<%= search %>" class="form-control">
        <select name="category" class="form-control">
            <option value="">All Categories</option>
            <% categories.forEach(cat => { %>
                <option value="<%= cat.category_name %>" <%= category === cat.category_name ? 'selected' : '' %>><%= cat.category_name %></option>
            <% }) %>
        </select>
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Brand</th>
                <th>Category</th>
                <th>Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% if (products && products.length > 0) { %>
                <% products.forEach(product => { %>
                    <tr>
                        <td><%= product.product_id %></td>
                        <td>
                            <a href="/admin/products/<%= product.product_id %>" class="table-link"><%= product.product_name %></a>
                        </td>
                        <td><%= product.brand %></td>
                        <td><%= product.category %></td>
                        <td>$<%= Number(product.price).toFixed(2) %></td>
                        <td class="table-actions">
                            <a href="/admin/products/<%= product.product_id %>/edit" class="btn-icon btn-edit" title="Edit">
                                <i class="fas fa-pencil-alt"></i>
                            </a>
                            <form action="/admin/products/<%= product.product_id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this product?');" style="display: inline;">
                                <button type="submit" class="btn-icon btn-delete" title="Delete">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td colspan="6" class="text-center">No products found.</td>
                </tr>
            <% } %>
        </tbody>
    </table>

    <% if (totalPages > 1) { %>
        <nav>
            <ul class="pagination">
                <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                    <a class="page-link" href="?page=<%= currentPage - 1 %>&search=<%= search %>&category=<%= category %>&limit=<%= limit %>">Previous</a>
                </li>

                <% 
                const maxPagesToShow = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
                let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
                if (endPage - startPage + 1 < maxPagesToShow) {
                    startPage = Math.max(1, endPage - maxPagesToShow + 1);
                }
                %>
                
                <% if (startPage > 1) { %>
                    <li class="page-item"><a class="page-link" href="?page=1&search=<%= search %>&category=<%= category %>&limit=<%= limit %>">1</a></li>
                    <% if (startPage > 2) { %><li class="page-item disabled"><span class="page-link">...</span></li><% } %>
                <% } %>
                
                <% for (let i = startPage; i <= endPage; i++) { %>
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= i %>&search=<%= search %>&category=<%= category %>&limit=<%= limit %>"><%= i %></a>
                    </li>
                <% } %>

                <% if (endPage < totalPages) { %>
                    <% if (endPage < totalPages - 1) { %><li class="page-item disabled"><span class="page-link">...</span></li><% } %>
                    <li class="page-item"><a class="page-link" href="?page=<%= totalPages %>&search=<%= search %>&category=<%= category %>&limit=<%= limit %>"><%= totalPages %></a></li>
                <% } %>


                <li class="page-item <%= currentPage >= totalPages ? 'disabled' : '' %>">
                    <a class="page-link" href="?page=<%= Number(currentPage) + 1 %>&search=<%= search %>&category=<%= category %>&limit=<%= limit %>">Next</a>
                </li>
            </ul>
        </nav>
    <% } %>
</div>

<%- include('../../partials/Afooter') %>

